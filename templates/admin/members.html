import React, { useState, useEffect } from 'react';

const ManageMembers = () => {
  const [members, setMembers] = useState([]);
  const [search, setSearch] = useState('');
  const [statusFilter, setStatusFilter] = useState('');
  const [rankFilter, setRankFilter] = useState('');
  const [modalVisible, setModalVisible] = useState(false);
  const [selectedMember, setSelectedMember] = useState(null);

  useEffect(() => {
    // Fetch members from API
    fetch('/api/members')
      .then(res => res.json())
      .then(data => setMembers(data));
  }, []);

  const filteredMembers = members.filter(member => {
    const matchSearch = `${member.user.username} ${member.user.first_name} ${member.mobile_no}`.toLowerCase().includes(search.toLowerCase());
    const matchStatus = statusFilter ? member.status === statusFilter : true;
    const matchRank = rankFilter !== '' ? member.rank_no.toString() === rankFilter : true;
    return matchSearch && matchStatus && matchRank;
  });

  const handleToggleStatus = (id) => {
    if (window.confirm('Are you sure you want to toggle the member status?')) {
      // Call API to toggle status
      alert(`Toggling status for ID: ${id}`);
    }
  };

  const handleBlockUnblock = (id, isBlocked) => {
    const action = isBlocked ? 'unblock' : 'block';
    if (window.confirm(`Are you sure you want to ${action} this member?`)) {
      // Call API to block/unblock
      alert(`${action} member with ID: ${id}`);
    }
  };

  const openModal = (member) => {
    setSelectedMember(member);
    setModalVisible(true);
  };

  return (
    <div className="p-6">
      <div className="flex justify-between items-center mb-6">
        <div>
          <h1 className="text-3xl font-bold">Manage Members</h1>
          <p className="text-gray-600">View and manage all MLM members</p>
        </div>
        <div className="space-x-3">
          <button className="bg-white text-gray-700 border px-4 py-2 rounded shadow" onClick={() => alert('Redirect to Plans')}>Manage Plans</button>
          <button className="bg-blue-600 text-white px-4 py-2 rounded shadow" onClick={() => alert('Add Member Modal')}>Add Member</button>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <StatCard icon="fas fa-users" label="Total Members" value={members.length} color="blue" />
        <StatCard icon="fas fa-user-check" label="Active Members" value={members.filter(m => m.status === 'Active').length} color="green" />
        <StatCard icon="fas fa-user-times" label="Inactive Members" value={members.filter(m => m.status === 'Inactive').length} color="red" />
        <StatCard icon="fas fa-calendar-plus" label="New This Month" value={0} color="purple" />
      </div>

      <div className="bg-white p-4 rounded shadow mb-6">
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <input type